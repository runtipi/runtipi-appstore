{
  "services": [
    {
      "name": "bewcloud",
      "image": "ghcr.io/bewcloud/bewcloud:v3.0.0",
      "internalPort": 8053,
      "isMain": true,
      "entrypoint": "bash",
      "command": "-c \"deno run --allow-net --allow-read --allow-env migrate-db.ts && deno run --allow-all main.ts\"",
      "environment": [
        {
          "key": "PORT",
          "value": "8053"
        },
        {
          "key": "BASE_URL",
          "value": "${APP_PROTOCOL:-http}://${APP_DOMAIN}"
        },
        {
          "key": "POSTGRESQL_HOST",
          "value": "bewcloud-db"
        },
        {
          "key": "POSTGRESQL_USER",
          "value": "bewcloud"
        },
        {
          "key": "POSTGRESQL_PASSWORD",
          "value": "${DB_PASSWORD}"
        },
        {
          "key": "POSTGRESQL_DBNAME",
          "value": "bewcloud"
        },
        {
          "key": "POSTGRESQL_PORT",
          "value": "5432"
        },
        {
          "key": "JWT_SECRET",
          "value": "${JWT_SECRET}"
        },
        {
          "key": "PASSWORD_SALT",
          "value": "${PASSWORD_SALT}"
        },
        {
          "key": "BREVO_API_KEY",
          "value": "${BREVO_API_KEY}"
        },
        {
          "key": "CONFIG_ALLOW_SIGNUPS",
          "value": "${ALLOW_SIGNUPS}"
        },
        {
          "key": "CONFIG_ENABLED_APPS",
          "value": "news,notes,photos"
        },
        {
          "key": "CONFIG_FILES_ROOT_PATH",
          "value": "data-files"
        },
        {
          "key": "CONFIG_ENABLE_EMAILS",
          "value": "${ENABLE_EMAIL}"
        },
        {
          "key": "CONFIG_ALLOWED_COOKIE_DOMAINS",
          "value": "${INTERNAL_IP},bewcloud.${LOCAL_DOMAIN},${APP_HOST}"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/bewcloud",
          "containerPath": "/app/data-files"
        }
      ]
    },
    {
      "name": "bewcloud-db",
      "image": "postgres:15",
      "environment": [
        {
          "key": "POSTGRES_USER",
          "value": "bewcloud"
        },
        {
          "key": "POSTGRES_PASSWORD",
          "value": "${DB_PASSWORD}"
        },
        {
          "key": "POSTGRES_DB",
          "value": "bewcloud"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/bewcloud/db",
          "containerPath": "/var/lib/postgresql/data"
        }
      ]
    }
  ],
  "schemaVersion": 2,
  "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json"
}
