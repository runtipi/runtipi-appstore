{
  "schemaVersion": 2,
  "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
  "services": [
    {
      "image": "ghcr.io/atuinsh/atuin:v18.10.0",
      "name": "atuin",
      "internalPort": 8888,
      "isMain": true,
      "command": "server start",
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/config",
          "containerPath": "/config"
        }
      ],
      "environment": [
        { "key": "ATUIN_PORT", "value": 8888 },
        { "key": "ATUIN_HOST", "value": "0.0.0.0" },
        { "key": "ATUIN_OPEN_REGISTRATION", "value": "${ATUIN_ALLOW_REGISTRATION}" },
        { "key": "ATUIN_DB_URI", "value": "postgres://atuin:${ATUIN_DB_PASSWORD}@atuin-db/atuin" }
      ]
    },
    {
      "image": "postgres:14",
      "name": "atuin-db",
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/postgres",
          "containerPath": "/var/lib/postgresql/data/"
        }
      ],
      "environment": [
        { "key": "POSTGRES_USER", "value": "atuin" },
        { "key": "POSTGRES_PASSWORD", "value": "${ATUIN_DB_PASSWORD}" },
        { "key": "POSTGRES_DB", "value": "atuin" }
      ]
    }
  ]
}
