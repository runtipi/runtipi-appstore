{
  "services": [
    {
      "name": "photoprism",
      "image": "photoprism/photoprism:latest",
      "isMain": true,
      "internalPort": 2342,
      "environment": [
        {
          "key": "PHOTOPRISM_ADMIN_PASSWORD",
          "value": "${PHOTOPRISM_ADMIN_PASSWORD}"
        },
        {
          "key": "PHOTOPRISM_SITE_URL",
          "value": "${APP_PROTOCOL:-http}://${APP_DOMAIN}/"
        },
        {
          "key": "PHOTOPRISM_ORIGINALS_LIMIT",
          "value": 5000
        },
        {
          "key": "PHOTOPRISM_HTTP_COMPRESSION",
          "value": "gzip"
        },
        {
          "key": "PHOTOPRISM_LOG_LEVEL",
          "value": "info"
        },
        {
          "key": "PHOTOPRISM_PUBLIC",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_READONLY",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_EXPERIMENTAL",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_DISABLE_CHOWN",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_DISABLE_WEBDAV",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_DISABLE_SETTINGS",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_DISABLE_TENSORFLOW",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_DISABLE_FACES",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_DISABLE_CLASSIFICATION",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_DISABLE_RAW",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_RAW_PRESETS",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_JPEG_QUALITY",
          "value": 85
        },
        {
          "key": "PHOTOPRISM_DETECT_NSFW",
          "value": "false"
        },
        {
          "key": "PHOTOPRISM_UPLOAD_NSFW",
          "value": "true"
        },
        {
          "key": "PHOTOPRISM_DATABASE_DRIVER",
          "value": "mysql"
        },
        {
          "key": "PHOTOPRISM_DATABASE_SERVER",
          "value": "photoprism-db:3306"
        },
        {
          "key": "PHOTOPRISM_DATABASE_NAME",
          "value": "photoprism"
        },
        {
          "key": "PHOTOPRISM_DATABASE_USER",
          "value": "photoprism"
        },
        {
          "key": "PHOTOPRISM_DATABASE_PASSWORD",
          "value": "${DB_PASSWORD}"
        },
        {
          "key": "PHOTOPRISM_SITE_CAPTION",
          "value": "AI-Powered Photos App"
        }
      ],
      "dependsOn": ["photoprism-db"],
      "volumes": [
        {
          "hostPath": "${ROOT_FOLDER_HOST}/media/data/images",
          "containerPath": "/photoprism/originals"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/photoprism/storage",
          "containerPath": "/photoprism/storage"
        }
      ],
      "workingDir": "/photoprism"
    },
    {
      "name": "photoprism-db",
      "image": "mariadb:10.8",
      "environment": [
        {
          "key": "MARIADB_DATABASE",
          "value": "photoprism"
        },
        {
          "key": "MARIADB_USER",
          "value": "photoprism"
        },
        {
          "key": "MARIADB_PASSWORD",
          "value": "${DB_PASSWORD}"
        },
        {
          "key": "MARIADB_ROOT_PASSWORD",
          "value": "${DB_ROOT_PASSWORD}"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/mariadb",
          "containerPath": "/var/lib/mysql"
        }
      ],
      "command": "mysqld --innodb-buffer-pool-size=128M --transaction-isolation=READ-COMMITTED --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci --max-connections=512 --innodb-rollback-on-timeout=OFF --innodb-lock-wait-timeout=120"
    }
  ],
  "overrides": [
    {
      "architecture": "arm64",
      "services": [
        {
          "name": "photoprism",
          "image": "photoprism/photoprism:arm64"
        }
      ]
    }
  ],
  "schemaVersion": 2,
  "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json"
}
